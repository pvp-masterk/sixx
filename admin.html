<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>/six Admin // Enhanced</title>

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/@phosphor-icons/web"></script>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
/* ======================= VARIABLES & RESET ======================= */
:root {
  --bg-core: #050208;
  --bg-card: rgba(20, 10, 30, 0.4);
  --bg-glass: rgba(255, 255, 255, 0.03);
  --border-glass: rgba(255, 255, 255, 0.08);
  
  --c-accent: #7b2cbf;
  --c-accent-glow: #b160fb;
  --c-success: #00f5d4;
  --c-danger: #ff0054;
  --c-text: #e8e6f3;
  --c-text-dim: #8f8ba0;

  --ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
  --ease-smooth: cubic-bezier(0.2, 0.8, 0.2, 1);
}

* { box-sizing: border-box; margin: 0; padding: 0; outline: none; user-select: none; }
body {
  font-family: 'Inter', sans-serif;
  background: var(--bg-core);
  color: var(--c-text);
  overflow-x: hidden;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

/* Background FX */
.bg-mesh {
  position: fixed; inset: 0; z-index: -1;
  background: 
    radial-gradient(circle at 15% 50%, rgba(123, 44, 191, 0.15), transparent 25%),
    radial-gradient(circle at 85% 30%, rgba(67, 97, 238, 0.1), transparent 25%);
  filter: blur(60px);
}

/* Custom Scrollbar */
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--c-accent); }

/* ======================= LAYOUT ======================= */
.app-container {
  max-width: 1600px; width: 100%; margin: 0 auto;
  padding: 20px; flex: 1; display: flex; flex-direction: column; gap: 20px;
  overflow: hidden; /* Fix for internal scrolling */
}

/* Header */
.top-bar {
  display: flex; justify-content: space-between; align-items: center;
  padding: 15px 25px;
  background: rgba(10,5,15,0.6);
  border: 1px solid var(--border-glass);
  border-radius: 16px;
  backdrop-filter: blur(10px);
}

.brand { 
  font-family: 'JetBrains Mono', monospace; 
  font-weight: 800; font-size: 20px; 
  background: linear-gradient(to right, #fff, var(--c-accent-glow));
  -webkit-background-clip: text; color: transparent;
  letter-spacing: -1px;
}

/* Controls Bar */
.controls-bar {
  display: flex; gap: 15px; align-items: center; flex-wrap: wrap;
}

.input-group {
  position: relative; flex: 1; min-width: 250px;
}
.input-custom {
  width: 100%; background: var(--bg-glass);
  border: 1px solid var(--border-glass);
  color: #fff; padding: 12px 15px 12px 40px;
  border-radius: 10px; font-family: 'Inter'; font-size: 14px;
  transition: 0.2s;
}
.input-custom:focus { border-color: var(--c-accent); box-shadow: 0 0 15px rgba(123,44,191,0.2); }
.input-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--c-text-dim); }

/* Custom Button */
.btn {
  background: var(--bg-glass); border: 1px solid var(--border-glass);
  color: var(--c-text); padding: 10px 16px; border-radius: 8px;
  font-size: 13px; font-weight: 600; cursor: pointer;
  display: flex; align-items: center; gap: 8px;
  transition: 0.2s var(--ease-smooth);
}
.btn:hover { background: rgba(255,255,255,0.08); transform: translateY(-1px); }
.btn.primary { background: var(--c-accent); border-color: var(--c-accent); color: #fff; }
.btn.primary:hover { background: var(--c-accent-glow); box-shadow: 0 0 20px rgba(123,44,191,0.4); }

/* ======================= GRID & CARDS ======================= */
.content-area {
  flex: 1; overflow-y: auto; padding-right: 5px;
}

.user-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px;
  padding-bottom: 40px;
}

.user-card {
  position: relative;
  background: var(--bg-card);
  border: 1px solid var(--border-glass);
  border-radius: 12px; padding: 20px;
  display: flex; flex-direction: column; gap: 12px;
  transition: 0.2s; overflow: hidden;
}

.user-card:hover { border-color: rgba(123, 44, 191, 0.5); transform: translateY(-2px); }

/* Performance Hover Glow (CSS Only) */
.user-card::before {
  content: ""; position: absolute; inset: 0;
  background: radial-gradient(800px circle at var(--mouse-x, 50%) var(--mouse-y, 50%), rgba(255,255,255,0.06), transparent 40%);
  opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 0;
}
.user-card:hover::before { opacity: 1; }

.uc-top { display: flex; align-items: flex-start; gap: 12px; z-index: 1; position: relative; }
.uc-avatar { width: 44px; height: 44px; border-radius: 10px; background: #000; object-fit: cover; border: 2px solid rgba(255,255,255,0.1); }
.uc-details { flex: 1; min-width: 0; }
.uc-name { font-weight: 700; font-size: 15px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #fff; }
.uc-uuid { font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--c-text-dim); cursor: pointer; display: flex; align-items: center; gap: 5px;}
.uc-uuid:hover { color: var(--c-accent-glow); }

.uc-badges { display: flex; gap: 5px; margin-top: 4px; flex-wrap: wrap; }
.badge {
  font-size: 9px; padding: 3px 6px; border-radius: 4px; text-transform: uppercase; font-weight: 700; letter-spacing: 0.5px;
  border: 1px solid transparent;
}
.badge.founder { border-color: #ffd700; color: #ffd700; background: rgba(255,215,0,0.1); }
.badge.admin { border-color: #f72585; color: #f72585; background: rgba(247,37,133,0.1); }
.badge.moderator { border-color: #4cc9f0; color: #4cc9f0; background: rgba(76,201,240,0.1); }
.badge.user { border-color: var(--border-glass); color: #aaa; }

.uc-actions {
  z-index: 1; position: relative;
  display: flex; gap: 8px; margin-top: auto; padding-top: 15px;
  border-top: 1px solid rgba(255,255,255,0.05);
}

/* ======================= CUSTOM UI ELEMENTS ======================= */
/* Custom Select */
.c-select { position: relative; flex: 1; }
.c-select-trigger {
  width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border-glass);
  color: #fff; font-size: 11px; padding: 8px 10px; border-radius: 6px;
  display: flex; justify-content: space-between; align-items: center; cursor: pointer;
}
.c-select-options {
  position: absolute; bottom: 100%; left: 0; width: 100%;
  background: #0f0a18; border: 1px solid var(--border-glass);
  border-radius: 6px; padding: 4px; display: none; z-index: 100;
  box-shadow: 0 10px 20px rgba(0,0,0,0.5);
}
.c-select.active .c-select-options { display: block; animation: fadeIn 0.1s; }
.c-option {
  padding: 6px 10px; font-size: 11px; color: #ccc; cursor: pointer; border-radius: 4px;
}
.c-option:hover { background: var(--c-accent); color: #fff; }

/* Context Menu */
#context-menu {
  position: fixed; z-index: 9999;
  background: #0f0a18; border: 1px solid var(--border-glass);
  border-radius: 8px; padding: 6px; width: 180px;
  box-shadow: 0 0 30px rgba(0,0,0,0.8);
  opacity: 0; pointer-events: none; transition: opacity 0.1s;
}
#context-menu.show { opacity: 1; pointer-events: auto; }
.ctx-item {
  padding: 8px 12px; font-size: 12px; color: #eee; cursor: pointer;
  border-radius: 4px; display: flex; align-items: center; gap: 8px;
}
.ctx-item:hover { background: rgba(255,255,255,0.1); }
.ctx-item.danger { color: var(--c-danger); }
.ctx-item.danger:hover { background: rgba(255,0,84,0.15); }

/* Pagination */
.pagination {
  display: flex; justify-content: center; align-items: center; gap: 10px; padding-top: 20px;
}
.page-btn {
  width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;
  background: var(--bg-glass); border: 1px solid var(--border-glass); border-radius: 6px;
  color: #fff; cursor: pointer; transition: 0.2s;
}
.page-btn:hover:not(:disabled) { background: var(--c-accent); border-color: var(--c-accent); }
.page-btn:disabled { opacity: 0.3; cursor: not-allowed; }

/* Skeletons */
.skeleton { background: linear-gradient(90deg, #1a1a1a 25%, #2a2a2a 50%, #1a1a1a 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; border-radius: 4px; }
.sk-avatar { width: 44px; height: 44px; border-radius: 10px; }
.sk-text { height: 14px; width: 60%; margin-bottom: 6px; }
@keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

/* Toast */
.toast-container { position: fixed; bottom: 30px; right: 30px; z-index: 2000; display: flex; flex-direction: column; gap: 10px; }
.toast {
  background: rgba(15,10,25,0.9); border: 1px solid var(--border-glass); border-left: 3px solid var(--c-accent);
  color: #fff; padding: 12px 20px; border-radius: 8px; font-size: 13px; font-weight: 500;
  box-shadow: 0 10px 30px rgba(0,0,0,0.5); backdrop-filter: blur(10px);
  transform: translateX(100px); opacity: 0; animation: slideIn 0.3s forwards;
}
@keyframes slideIn { to { transform: translateX(0); opacity: 1; } }
.modal-overlay {
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.6); backdrop-filter: blur(8px);
  display: flex; align-items: center; justify-content: center;
  opacity: 0; pointer-events: none; transition: 0.3s; z-index: 2000;
}
.modal-overlay.active { opacity: 1; pointer-events: auto; }
.modal-box.showcase {
  width: 90%; max-width: 700px; max-height: 80vh; display: flex;
  flex-direction: column; background: linear-gradient(135deg, rgba(123,44,191,0.2), rgba(157,78,221,0.2));
  border-radius: 20px; border: 2px solid rgba(255,255,255,0.1);
  padding: 0; overflow: hidden; backdrop-filter: blur(12px); animation: modalFade 0.3s ease;
}
.modal-header, .modal-footer { padding: 15px 20px; background: rgba(20,10,35,0.5); display: flex; justify-content: space-between; align-items: center; }
.modal-content { flex: 1; overflow-y: auto; padding: 20px; background: rgba(10,5,20,0.6); }
.modal-content pre { background: #1b0c3b; color: #e0e0ff; padding: 15px; border-radius: 12px; overflow-x: auto; }
.close-btn { background: transparent; border: none; color: #fff; font-size: 24px; cursor: pointer; }
.action-btn { background: linear-gradient(90deg,#7b2cbf,#9d4edd); color:#fff; padding:8px 18px; border-radius:10px; border:none; cursor:pointer; font-weight:600; }
@keyframes modalFade { from { transform: translateY(-30px); opacity:0; } to { transform: translateY(0); opacity:1; } }
.modal-overlay { position:fixed; inset:0; display:flex; justify-content:center; align-items:center; background:rgba(0,0,0,0.6); backdrop-filter:blur(6px); opacity:0; pointer-events:none; transition:0.2s; z-index:3000; }
.modal-overlay.active { opacity:1; pointer-events:auto; }
.modal-box { width:90%; max-width:600px; max-height:80vh; background:rgba(20,10,35,0.7); border-radius:16px; border:1px solid rgba(255,255,255,0.1); display:flex; flex-direction:column; overflow:hidden; }
.modal-header, .modal-footer { padding:12px 20px; display:flex; justify-content:space-between; align-items:center; background:rgba(10,5,20,0.5); }
.modal-content { flex:1; padding:15px 20px; overflow-y:auto; color:#fff; font-size:13px; }
.modal-content img { max-width:100%; margin-top:6px; border-radius:8px; }
.action-btn { padding:6px 14px; border:none; border-radius:10px; background:linear-gradient(90deg,#7b2cbf,#9d4edd); color:#fff; cursor:pointer; font-weight:600; display:flex; align-items:center; gap:4px; }

</style>
  
</head>
<body>

<div class="bg-mesh"></div>

<div class="app-container">
  <!-- Top Bar -->
  <header class="top-bar">
    <div style="display:flex; align-items:center; gap:15px;">
      <div class="brand">/six ADMIN</div>
      <div class="badge admin" id="connection-status">CONNECTED</div>
    </div>
    
    <div style="display:flex; align-items:center; gap:15px;">
      <div style="text-align:right; line-height:1.2;">
        <div style="font-size:12px; font-weight:700; color:#fff;" id="my-username">...</div>
        <div style="font-size:10px; color:var(--c-text-dim);">SUPERUSER</div>
      </div>
      <img id="my-avatar" src="" style="width:36px; height:36px; border-radius:50%; background:#222; border:1px solid #444;">
    </div>
  </header>

  <!-- Controls -->
  <div class="controls-bar">
    <div class="input-group">
      <i class="ph ph-magnifying-glass input-icon"></i>
      <input type="text" class="input-custom" id="search-input" placeholder="Search Users, IDs, IPs..." onkeyup="app.handleSearch()">
    </div>
    
    <div style="display:flex; gap:10px;">
      <!-- Custom Sort Dropdown -->
      <div class="c-select" style="width: 150px;">
        <div class="c-select-trigger" onclick="ui.toggleSelect(this)">
          <span id="sort-label">Newest First</span> <i class="ph ph-caret-down"></i>
        </div>
        <div class="c-select-options">
          <div class="c-option" onclick="app.sort('new')">Newest First</div>
          <div class="c-option" onclick="app.sort('old')">Oldest First</div>
          <div class="c-option" onclick="app.sort('alpha')">Username A-Z</div>
        </div>
      </div>

      <button class="btn" onclick="app.refreshData()"><i class="ph ph-arrows-clockwise"></i> Refresh</button>
      <button class="btn primary"><i class="ph ph-plus"></i> Invite</button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="content-area">
    <div id="user-grid" class="user-grid">
      <!-- Cards Injected Here -->
    </div>
    
    <div class="pagination">
      <button class="page-btn" id="prev-btn" onclick="app.changePage(-1)"><i class="ph ph-caret-left"></i></button>
      <span style="font-size:12px; color:var(--c-text-dim);">Page <span id="curr-page" style="color:#fff;">1</span></span>
      <button class="page-btn" id="next-btn" onclick="app.changePage(1)"><i class="ph ph-caret-right"></i></button>
    </div>
  </div>
</div>

<!-- Custom Context Menu -->
<div id="context-menu">
  <div class="ctx-item" onclick="app.ctxAction('copy')"><i class="ph ph-copy"></i> Copy UUID</div>
  <div class="ctx-item" onclick="app.ctxAction('json')"><i class="ph ph-code"></i> View Raw Data</div>
  <div style="height:1px; background:rgba(255,255,255,0.1); margin:4px 0;"></div>
  <div class="ctx-item danger" onclick="app.ctxAction('ban')"><i class="ph ph-prohibit"></i> Ban User</div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toast-container"></div>

<script>
// ==================== CONFIG & STATE ====================
const SUPABASE_URL = "https://tstsijdifhgmpaszqknr.supabase.co"; 
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRzdHNpamRpZmhnbXBhc3pxa25yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5NzA1NTIsImV4cCI6MjA3ODU0NjU1Mn0.8AvcLNL-6PIlfw2FUeLcMC9atefZmZAyUQBOquGpVo4";

const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const STATE = {
  users: [],
  filteredUsers: [],
  page: 1,
  limit: 24, // Cards per page
  currentUser: null,
  sortMode: 'new',
  ctxTargetId: null // ID of user right-clicked
};

const ROLES = ['founder', 'admin', 'moderator', 'verified', 'user'];

// ==================== APP LOGIC ====================
const app = {
  init: async () => {
    ui.renderSkeleton();
    await app.checkAuth();
    await app.fetchData();
    
    // Global Event for closing dropdowns
    document.addEventListener('click', (e) => {
      if(!e.target.closest('.c-select')) {
        document.querySelectorAll('.c-select').forEach(el => el.classList.remove('active'));
      }
      if(!e.target.closest('#context-menu')) {
        document.getElementById('context-menu').classList.remove('show');
      }
    });
  },

  checkAuth: async () => {
    const { data: { user } } = await supabaseClient.auth.getUser();
    if(user) {
      const { data } = await supabaseClient.from('profiles').select('*').eq('id', user.id).single();
      STATE.currentUser = data || { username: 'Admin', role: 'founder', avatar: null };
    } else {
      STATE.currentUser = { username: 'System Admin', role: 'founder', avatar: null }; 
    }
    
    document.getElementById('my-username').textContent = STATE.currentUser.username;
    if(STATE.currentUser.avatar) document.getElementById('my-avatar').src = STATE.currentUser.avatar;
  },

  fetchData: async () => {
    const { data, error } = await supabaseClient
      .from('profiles')
      .select('*')
      .order('created_at', { ascending: false });

    if(error) {
      ui.toast('Error fetching data', 'error');
      console.error(error);
      return;
    }

    STATE.users = data;
    STATE.filteredUsers = data;
    app.applySort();
    app.renderPage();
  },

  handleSearch: () => {
    clearTimeout(window.searchDebounce);
    window.searchDebounce = setTimeout(() => {
      const term = document.getElementById('search-input').value.toLowerCase();
      STATE.filteredUsers = STATE.users.filter(u => 
        (u.username && u.username.toLowerCase().includes(term)) || 
        (u.id && u.id.includes(term)) ||
        (u.role && u.role.includes(term))
      );
      STATE.page = 1;
      app.renderPage();
    }, 300);
  },

  sort: (mode) => {
    STATE.sortMode = mode;
    const map = { 'new': 'Newest First', 'old': 'Oldest First', 'alpha': 'Username A-Z' };
    document.getElementById('sort-label').innerText = map[mode];
    app.applySort();
    app.renderPage();
  },

  applySort: () => {
    if(STATE.sortMode === 'new') STATE.filteredUsers.sort((a,b) => new Date(b.created_at) - new Date(a.created_at));
    if(STATE.sortMode === 'old') STATE.filteredUsers.sort((a,b) => new Date(a.created_at) - new Date(b.created_at));
    if(STATE.sortMode === 'alpha') STATE.filteredUsers.sort((a,b) => a.username.localeCompare(b.username));
  },

  changePage: (dir) => {
    const maxPage = Math.ceil(STATE.filteredUsers.length / STATE.limit);
    const newPage = STATE.page + dir;
    if(newPage > 0 && newPage <= maxPage) {
      STATE.page = newPage;
      app.renderPage();
    }
  },

  refreshData: () => {
    ui.renderSkeleton();
    app.fetchData();
    ui.toast('Data Refreshed');
  },

  updateRole: async (uid, newRole) => {
    const uIndex = STATE.users.findIndex(u => u.id === uid);
    if(uIndex > -1) STATE.users[uIndex].role = newRole;
    app.renderPage(); 

    const { error } = await supabaseClient.from('profiles').update({ role: newRole }).eq('id', uid);
    if(error) {
      ui.toast('Failed to update role', 'error');
      app.refreshData();
    } else {
      ui.toast(`Role updated to ${newRole.toUpperCase()}`);
    }
  },

  ctxAction: (action) => {
    const user = STATE.users.find(u => u.id === STATE.ctxTargetId);
    if(!user) return;
    
    document.getElementById('context-menu').classList.remove('show');

    if(action === 'copy') {
      navigator.clipboard.writeText(user.id);
      ui.toast('UUID Copied to Clipboard');
    }
    if(action === 'json') {
      console.log(user);
      alert(JSON.stringify(user, null, 2));
    }
    if(action === 'ban') {
      if(confirm(`Are you sure you want to BAN ${user.username}?`)) {
        ui.toast('User Banned (Simulated)', 'error');
      }
    }
  },

  // âœ… Correctly defined modal functions
  updateUserModal: async () => {
    const uid = STATE.ctxTargetId;
    const bio = document.getElementById('modal-bio').value;
    const avatar = document.getElementById('modal-avatar-url').value;
    const banner = document.getElementById('modal-banner-url').value;

    const updates = { bio, avatar, banner };

    const { error } = await supabaseClient.from('profiles').update(updates).eq('id', uid);
    if(error) {
      ui.toast('Failed to update user', 'error');
      console.error(error);
    } else {
      const uIndex = STATE.users.findIndex(u => u.id === uid);
      if(uIndex > -1) STATE.users[uIndex] = { ...STATE.users[uIndex], ...updates };
      ui.toast('User updated successfully');
      app.renderPage();
      ui.closeUserModal();
    }
  },

  banUserModal: async () => {
    const uid = STATE.ctxTargetId;
    const user = STATE.users.find(u => u.id === uid);
    if(!user) return;

    if(confirm(`Are you sure you want to BAN ${user.username}?`)) {
      ui.toast('User banned (simulated)', 'error');
      ui.closeUserModal();
    }
  },

  renderPage: () => {
    const grid = document.getElementById('user-grid');
    const start = (STATE.page - 1) * STATE.limit;
    const end = start + STATE.limit;
    const subset = STATE.filteredUsers.slice(start, end);

    document.getElementById('curr-page').innerText = STATE.page;
    document.getElementById('prev-btn').disabled = STATE.page === 1;
    document.getElementById('next-btn').disabled = end >= STATE.filteredUsers.length;

    if(subset.length === 0) {
      grid.innerHTML = `<div style="grid-column:1/-1; text-align:center; padding:50px; color:var(--c-text-dim);">No users found.</div>`;
      return;
    }

    let html = '';
    subset.forEach(u => { html += ui.buildCard(u); });
    grid.innerHTML = html;

    document.querySelectorAll('.user-card').forEach(card => {
      card.addEventListener('mousemove', (e) => {
        const rect = card.getBoundingClientRect();
        card.style.setProperty('--mouse-x', `${e.clientX - rect.left}px`);
        card.style.setProperty('--mouse-y', `${e.clientY - rect.top}px`);
      });
      card.addEventListener('contextmenu', (e) => {
        e.preventDefault();
        STATE.ctxTargetId = card.dataset.id;
        const menu = document.getElementById('context-menu');
        menu.style.top = `${e.clientY}px`;
        menu.style.left = `${e.clientX}px`;
        menu.classList.add('show');
      });
    });
  }
};


// ==================== UI HELPERS ====================
const ui = {
  // Generates Custom Dropdown HTML
  buildRoleSelect: (u) => {
    // Only allow editing if current user has higher privs
    const currentIdx = ROLES.indexOf(STATE.currentUser.role.toLowerCase());
    const targetIdx = ROLES.indexOf(u.role.toLowerCase());

    const optionsHtml = ROLES.map(r => {
      const rIdx = ROLES.indexOf(r);
      const disabled = rIdx >= currentIdx; // Can't assign same or higher role
      return `<div class="c-option" 
                  onclick="${disabled ? '' : `app.updateRole('${u.id}', '${r}')`}" 
                  style="${disabled ? 'opacity:0.4; cursor:not-allowed;' : ''}">
                ${r.toUpperCase()}
              </div>`;
    }).join('');

    return `
      <div class="c-select" onclick="ui.toggleSelect(this); event.stopPropagation();">
        <div class="c-select-trigger">
          <span>${u.role.toUpperCase()}</span> <i class="ph ph-caret-down"></i>
        </div>
        <div class="c-select-options bottom-up">${optionsHtml}</div>
      </div>
    `;
  },

  // Build user card
  buildCard: (u) => {
    const date = new Date(u.created_at).toLocaleDateString();
    return `
      <div class="user-card" data-id="${u.id}" onclick="ui.showUserModal('${u.id}')">
        <div class="uc-top">
          <img src="${u.avatar || 'https://via.placeholder.com/100/000000/FFFFFF/?text=' + u.username.charAt(0)}" class="uc-avatar">
          <div class="uc-details">
            <div class="uc-name">${u.username}</div>
            <div class="uc-uuid" onclick="event.stopPropagation(); navigator.clipboard.writeText('${u.id}'); ui.toast('ID Copied')">
              ${u.id.substring(0,12)}... <i class="ph ph-copy"></i>
            </div>
            <div class="uc-badges">
              <span class="badge ${u.role}">${u.role.toUpperCase()}</span>
              <span class="badge user">${date}</span>
              <span class="badge" style="border-color:#ffb703;color:#ffb703;background:rgba(255,183,3,0.1);">IN DEVELOPMENT</span>
            </div>
          </div>
        </div>
        <div class="uc-actions">
          <button class="btn" style="padding:8px;" title="View Details" onclick="event.stopPropagation(); ui.showUserModal('${u.id}')">
            <i class="ph ph-eye"></i> View
          </button>
        </div>
      </div>
    `;
  },

  // Skeleton loading cards
  renderSkeleton: () => {
    const grid = document.getElementById('user-grid');
    let html = '';
    for(let i=0; i<12; i++) {
      html += `
        <div class="user-card">
          <div class="uc-top">
            <div class="skeleton sk-avatar"></div>
            <div class="uc-details">
              <div class="skeleton sk-text"></div>
              <div class="skeleton sk-text" style="width:40%"></div>
            </div>
          </div>
        </div>`;
    }
    grid.innerHTML = html;
  },

  toggleSelect: (el) => {
    // Close others
    document.querySelectorAll('.c-select').forEach(s => {
      if(s !== el) s.classList.remove('active');
    });
    el.classList.toggle('active');
  },

  toast: (msg, type = 'success') => {
    const con = document.getElementById('toast-container');
    const el = document.createElement('div');
    el.className = 'toast';
    if(type === 'error') el.style.borderLeftColor = 'var(--c-danger)';
    el.innerText = msg;
    con.appendChild(el);
    setTimeout(() => {
      el.style.opacity = '0';
      el.style.transform = 'translateX(100px)';
      setTimeout(() => el.remove(), 300);
    }, 3000);
  },

  showUserModal: (uid) => {
    const user = STATE.users.find(u => u.id === uid);
    if(!user) return;

    STATE.ctxTargetId = uid; // Keep track for updates

    document.getElementById('modal-avatar').src = user.avatar || 'https://via.placeholder.com/100/000000/FFFFFF/?text=' + user.username.charAt(0);
    document.getElementById('modal-username').textContent = user.username;
    document.getElementById('modal-role').textContent = user.role.toUpperCase();
    document.getElementById('modal-bio').value = user.bio || '';
    document.getElementById('modal-avatar-url').value = user.avatar || '';
    document.getElementById('modal-banner-url').value = user.banner || '';

    document.getElementById('user-modal').style.display = 'flex';
  },

  closeUserModal: () => {
    document.getElementById('user-modal').style.display = 'none';
  },

  showDataModal: (obj) => {
    document.getElementById('data-content').innerText = JSON.stringify(obj, null, 2);
    document.getElementById('data-modal').classList.add('active');
  },

  closeModal: () => {
    document.getElementById('data-modal').classList.remove('active');
  }
};

// Start App
window.addEventListener('DOMContentLoaded', app.init);

</script>
  <!-- Data Modal -->
<div id="data-modal" class="modal-overlay">
  <div class="modal-box showcase">
    <div class="modal-header">
      <h3>Raw User Data</h3>
      <button class="close-btn" onclick="ui.closeModal()">&times;</button>
    </div>
    <div class="modal-content">
      <pre id="data-content">{}</pre>
    </div>
    <div class="modal-footer">
      <button class="action-btn" onclick="ui.closeModal()">Close</button>
    </div>
  </div>
</div>
<!-- User Modal -->
<div id="user-modal" style="position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:10000;">
  <div style="background:var(--bg-card); border:1px solid var(--border-glass); border-radius:16px; width:400px; max-width:90%; padding:20px; position:relative; display:flex; flex-direction:column; gap:15px;">
    <button onclick="ui.closeUserModal()" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:18px; color:var(--c-text); cursor:pointer;">&times;</button>
    <div style="display:flex; align-items:center; gap:15px;">
      <img id="modal-avatar" src="" style="width:60px; height:60px; border-radius:12px; border:2px solid rgba(255,255,255,0.1); object-fit:cover;">
      <div>
        <div id="modal-username" style="font-weight:700; font-size:16px;"></div>
        <div id="modal-role" style="font-size:12px; color:var(--c-text-dim);"></div>
      </div>
    </div>
    <div>
      <label style="font-size:12px; color:var(--c-text-dim);">Bio:</label>
      <textarea id="modal-bio" style="width:100%; border-radius:8px; padding:8px; background:var(--bg-glass); border:1px solid var(--border-glass); color:#fff;"></textarea>
    </div>
    <div>
      <label style="font-size:12px; color:var(--c-text-dim);">Avatar URL:</label>
      <input type="text" id="modal-avatar-url" style="width:100%; border-radius:8px; padding:8px; background:var(--bg-glass); border:1px solid var(--border-glass); color:#fff;">
    </div>
    <div>
      <label style="font-size:12px; color:var(--c-text-dim);">Banner URL:</label>
      <input type="text" id="modal-banner-url" style="width:100%; border-radius:8px; padding:8px; background:var(--bg-glass); border:1px solid var(--border-glass); color:#fff;">
    </div>
    <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:5px;">
      <button class="btn primary" onclick="app.updateUserModal()">Save Changes</button>
      <button class="btn" onclick="app.banUserModal()">Ban User</button>
      <button class="btn" disabled title="In Development">Warn</button>
      <button class="btn" disabled title="In Development">Notify</button>
    </div>
  </div>
</div>


</body>
</html>

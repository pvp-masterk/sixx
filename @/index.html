<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Profile | /six</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Cinzel:wght@700&display=swap" rel="stylesheet">
<!-- Phosphor Icons (for profile specific icons) -->
<script src="https://unpkg.com/@phosphor-icons/web"></script>

<style>
/* ======================= 1. CORE VARIABLES & RESET (From Index) ======================= */
:root {
  --c-bg: #030005;
  --c-bg-alt: #0a0510;
  --c-accent: #7b2cbf;
  --c-accent-light: #9d4edd;
  --c-accent-glow: #e0aaff;
  --c-text-main: #e8e6f3;
  --c-text-dim: #8f8ba0;
  
  --c-glass: rgba(10, 5, 20, 0.6);
  --c-glass-hover: rgba(20, 10, 35, 0.8);
  --c-glass-border: rgba(255, 255, 255, 0.08);
  --c-glass-border-hover: rgba(157, 78, 221, 0.5);
  
  --font-main: 'Inter', sans-serif;
  --font-brand: 'Diecide Remain', 'Cinzel', serif;
  --ease-out: cubic-bezier(0.2, 0.8, 0.2, 1);
}

@font-face {
  font-family: 'Diecide Remain';
  src: url('fonts/DeicideRemain.otf') format('opentype');
  font-display: swap;
}

* { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
html, body { height: 100%; width: 100%; }

body {
  font-family: var(--font-main);
  background: var(--c-bg);
  color: var(--c-text-main);
  overflow-x: hidden; 
  line-height: 1.6;
}

/* Texture Overlay */
body::after {
  content: "";
  position: fixed; inset: 0; pointer-events: none; z-index: 900;
  background: repeating-linear-gradient(
    0deg,
    rgba(0,0,0,0.15),
    rgba(0,0,0,0.15) 1px,
    transparent 1px,
    transparent 2px
  );
  background-size: 100% 4px;
}

::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--c-bg); }
::-webkit-scrollbar-thumb { background: #331050; border-radius: 4px; }

/* Brand Text */
.brand-text {
  font-family: var(--font-brand);
  background: linear-gradient(135deg, #e0aaff, #9d4edd, #7b2cbf);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  text-shadow: 0 0 25px rgba(157, 78, 221, 0.5);
  font-weight: 900;
  letter-spacing: 1px;
}

/* ======================= 2. BACKGROUND ======================= */
.bg-fixed { position: fixed; inset: 0; z-index: 0; pointer-events: none; }
.bg-blob {
  position: absolute; border-radius: 50%; filter: blur(100px); opacity: 0.3;
  will-change: transform; animation: breath 10s infinite alternate ease-in-out;
}
.bg-blob.one { top: -20%; left: -10%; width: 60vw; height: 60vw; background: radial-gradient(#4a0072, transparent 70%); }
.bg-blob.two { bottom: -20%; right: -10%; width: 70vw; height: 70vw; background: radial-gradient(#240046, transparent 70%); animation-delay: -5s; }
@keyframes breath { 0% { transform: scale(1); } 100% { transform: scale(1.1); } }

/* ======================= 3. LAYOUT & SIDEBAR ======================= */
.sidebar-trigger {
  position: fixed; top: 30px; left: 30px; z-index: 100;
  width: 45px; height: 45px;
  background: rgba(10, 5, 20, 0.4);
  border: 1px solid var(--c-glass-border);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  color: #fff; cursor: pointer;
  transition: all 0.4s var(--ease-out);
  backdrop-filter: blur(8px);
}
.sidebar-trigger:hover { 
  background: var(--c-accent); border-color: var(--c-accent-light); 
  transform: rotate(90deg) scale(1.1); box-shadow: 0 0 15px rgba(123, 44, 191, 0.5);
}

.sidebar {
  position: fixed; top: 0; left: 0; bottom: 0; width: 300px;
  background: linear-gradient(90deg, #05020a, rgba(5, 2, 10, 0.9));
  border-right: 1px solid var(--c-glass-border);
  z-index: 99; padding: 100px 30px 40px;
  transform: translateX(-100%); transition: transform 0.6s var(--ease-out);
  display: flex; flex-direction: column;
}
.sidebar.active { transform: translateX(0); box-shadow: 20px 0 50px rgba(0,0,0,0.5); }
.nav-item {
  display: flex; align-items: center; gap: 18px; padding: 16px 20px; margin-bottom: 12px;
  color: var(--c-text-dim); text-decoration: none; border-radius: 12px; transition: 0.3s;
  font-weight: 500; border: 1px solid transparent;
}
.nav-item:hover { background: rgba(255,255,255,0.03); color: #fff; padding-left: 25px; border-color: rgba(255,255,255,0.08); }

/* ======================= 4. PROFILE SPECIFIC STYLES ======================= */
.app-container {
  position: relative; z-index: 10;
  max-width: 800px; margin: 0 auto; /* Narrower than index for profile focus */
  padding: 100px 20px 60px;
  opacity: 0; transform: translateY(20px);
  animation: fadeInUp 0.8s var(--ease-out) forwards;
}

@keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

/* Header reuse */
.app-header {
  display: flex; justify-content: space-between; align-items: flex-end;
  margin-bottom: 40px; padding-bottom: 20px;
  border-bottom: 1px solid rgba(255,255,255,0.05);
}
.header-title { font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 3px; color: var(--c-accent); margin-bottom: 4px; }
.header-brand { font-size: 42px; line-height: 1; text-decoration: none; }

/* Profile Card - Glassmorphism Enhanced */
.profile-card {
  background: var(--c-glass);
  border: 1px solid var(--c-glass-border);
  border-radius: 24px;
  overflow: hidden;
  position: relative;
  backdrop-filter: blur(16px);
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
  transition: border-color 0.3s ease;
}
.profile-card:hover { border-color: var(--c-glass-border-hover); }

/* Banner */
.profile-banner {
  width: 100%; height: 220px;
  background-color: #1a1a1a;
  position: relative;
  overflow: hidden;
}
.profile-banner img {
  width: 100%; height: 100%; object-fit: cover;
  opacity: 0.8; transition: transform 0.5s ease;
}
.profile-card:hover .profile-banner img { transform: scale(1.02); }
.profile-banner::after {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(to bottom, transparent 0%, var(--c-bg-alt) 100%);
  opacity: 0.6;
}

/* Avatar Area */
.profile-content {
  padding: 0 32px 40px;
  position: relative;
  margin-top: -60px; /* Pull up into banner */
  z-index: 2;
}

.avatar-row {
  display: flex; justify-content: space-between; align-items: flex-end;
  margin-bottom: 24px;
}

.avatar-wrapper {
  position: relative;
  padding: 4px;
  background: var(--c-bg); /* Match bg to create gap */
  border-radius: 50%;
  box-shadow: 0 0 30px rgba(0,0,0,0.5);
}
.profile-avatar {
  width: 120px; height: 120px;
  border-radius: 50%;
  object-fit: cover;
  display: block;
}

/* Action Buttons */
.action-btn {
  padding: 10px 24px;
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 8px;
  color: #fff; font-weight: 600; font-size: 13px;
  cursor: pointer; transition: 0.3s;
  display: flex; align-items: center; gap: 8px;
  text-decoration: none;
}
.action-btn:hover {
  background: rgba(255,255,255,0.1); border-color: #fff;
}
.action-btn.primary {
  background: rgba(123, 44, 191, 0.2);
  border-color: var(--c-accent);
  color: var(--c-accent-glow);
}
.action-btn.primary:hover {
  background: var(--c-accent);
  color: #fff;
  box-shadow: 0 0 20px rgba(123, 44, 191, 0.4);
}

/* User Info */
.user-identity { margin-bottom: 20px; }
.username-wrap { display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }
.username { 
  font-family: var(--font-brand); 
  font-size: 32px; 
  color: #fff; 
  line-height: 1.1;
}
.badge-verified {
  color: #5865F2; /* Discord color */
  font-size: 20px;
  filter: drop-shadow(0 0 8px rgba(88, 101, 242, 0.4));
}

.bio-text {
  color: var(--c-text-dim);
  font-size: 15px;
  line-height: 1.7;
  white-space: pre-wrap;
  margin-bottom: 25px;
  max-width: 600px;
}

/* Roles Grid */
.roles-grid { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 15px; }
.role-chip {
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.08);
  padding: 6px 14px;
  border-radius: 6px;
  font-size: 12px; font-weight: 600; letter-spacing: 0.5px;
  color: #ccc;
  display: flex; align-items: center; gap: 6px;
  transition: 0.2s;
}
.role-chip:hover {
  border-color: var(--c-accent);
  transform: translateY(-2px);
  color: #fff;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
.role-chip img { width: 14px; height: 14px; border-radius: 50%; }

/* Skeleton Loading */
.skeleton {
  background: linear-gradient(90deg, rgba(255,255,255,0.03) 25%, rgba(255,255,255,0.06) 50%, rgba(255,255,255,0.03) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 4px;
}
@keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

/* Footer */
footer { 
  text-align: center; padding-top: 40px; color: var(--c-text-dim); font-size: 12px; 
  border-top: 1px solid rgba(255,255,255,0.05); margin-top: 40px;
}
.error-msg { text-align: center; padding: 40px; color: #ff5555; }
</style>
</head>
<body>

  <!-- Background Ambience -->
  <div class="bg-fixed">
    <div class="bg-blob one"></div>
    <div class="bg-blob two"></div>
  </div>

  <!-- NAVIGATION SIDEBAR -->
  <div class="sidebar-trigger" onclick="app.toggleSidebar()">
    <svg style="width:24px;height:24px;fill:none;stroke:currentColor;stroke-width:2" viewBox="0 0 24 24"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
  </div>

  <nav id="sidebar" class="sidebar">
    <div style="margin-bottom: 40px; padding-left: 10px;">
      <div class="brand-text" style="font-size: 32px; line-height:1.2;">/SIX</div>
      <div style="font-size: 10px; color: #666; letter-spacing: 2px;">NAVIGATION</div>
    </div>
    <a href="/" class="nav-item">
      <i class="ph ph-house" style="font-size:20px;"></i> Home
    </a>
    <a href="/#roster" class="nav-item">
      <i class="ph ph-users" style="font-size:20px;"></i> Roster
    </a>
    <a href="/#gallery" class="nav-item">
      <i class="ph ph-image" style="font-size:20px;"></i> Gallery
    </a>
  </nav>

  <!-- MAIN APP -->
  <main class="app-container">
    
    <!-- Header -->
    <header class="app-header">
      <div>
        <div class="header-title">PROFILE</div>
        <a href="/" class="header-brand brand-text">/six</a>
      </div>
    </header>

    <!-- PROFILE CARD (ID: app) -->
    <div id="profile-target">
      <!-- Loading State -->
      <div class="profile-card">
        <div class="profile-banner skeleton"></div>
        <div class="profile-content">
          <div class="avatar-row">
            <div class="avatar-wrapper"><div class="profile-avatar skeleton"></div></div>
          </div>
          <div class="skeleton" style="height:30px; width:40%; margin-bottom:15px;"></div>
          <div class="skeleton" style="height:15px; width:80%; margin-bottom:8px;"></div>
          <div class="skeleton" style="height:15px; width:60%;"></div>
        </div>
      </div>
    </div>

    <footer>
      &copy; 2026 <span class="brand-text">/six</span>. Profile System.
    </footer>
  </main>

<!-- LOGIC -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
  // -- CONFIG --
  const SUPABASE_URL = "https://tstsijdifhgmpaszqknr.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRzdHNpamRpZmhnbXBhc3pxa25yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5NzA1NTIsImV4cCI6MjA3ODU0NjU1Mn0.8AvcLNL-6PIlfw2FUeLcMC9atefZmZAyUQBOquGpVo4";
  
  const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  const app = {
    init: () => {
      app.loadProfile();
      app.initScramble();
    },

    toggleSidebar: () => {
      document.getElementById('sidebar').classList.toggle('active');
    },

    // Text Scramble Effect from Index
    initScramble: () => {
      // Will apply to elements with class .scramble-hover
      const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ/<>[]#";
      document.body.addEventListener('mouseover', (e) => {
        if (e.target.classList.contains('scramble-hover')) {
          let iteration = 0;
          const originalText = e.target.dataset.text || e.target.innerText;
          let interval = setInterval(() => {
            e.target.innerText = originalText.split("")
              .map((letter, index) => {
                if(index < iteration) return originalText[index];
                return letters[Math.floor(Math.random() * 26)];
              }).join("");
            
            if(iteration >= originalText.length) clearInterval(interval);
            iteration += 1/3;
          }, 30);
        }
      });
    },

    escapeHtml: (unsafe) => {
      if (!unsafe) return "";
      return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    },

    loadProfile: async () => {
      const path = window.location.pathname;
      const username = decodeURIComponent(
        path.startsWith("/@") ? path.slice(2).replace(/\//g, "") : ""
      );

      console.log("Fetching:", username);

      if (!username) {
        app.renderError("User identity not found in datastream.");
        return;
      }

      const { data: profile, error } = await supabaseClient
        .from("profiles")
        .select("*")
        .eq("username", username)
        .eq("public", true)
        .single();

      if (error || !profile) {
        console.error(error);
        app.renderError("Profile restricted or non-existent.");
        return;
      }

      app.renderProfile(profile);
      app.checkAuth(profile);
    },

    renderProfile: (user) => {
      document.title = `${user.username} | /six Profile`;
      
      const avatar = user.avatar || "https://cdn.discordapp.com/embed/avatars/0.png";
      const bannerUrl = user.banner_url || ""; // Empty string triggers gradient fallback
      const safeBio = app.escapeHtml(user.bio);
      
      // Determine Banner HTML
      let bannerHTML = `<div style="width:100%; height:100%; background: linear-gradient(45deg, #1a0b2e, #2e1065);"></div>`;
      if (bannerUrl) {
        bannerHTML = `<img src="${app.escapeHtml(bannerUrl)}" alt="Banner" onload="this.style.opacity=0.8">`;
      }

      // Verification Badge Logic
      const isVerified = Array.isArray(user.roles) && user.roles.includes("Verified");
      const verifiedBadge = isVerified ? `<i class="ph-fill ph-seal-check badge-verified" title="Verified"></i>` : '';

      // Roles Logic
      let rolesHTML = '';
      if (user.roles && user.roles.length > 0) {
        rolesHTML = user.roles.map(role => {
          // Simple mapping for icons based on role name
          const iconSrc = `/assets/${role.toLowerCase()}.png`;
          // Fallback logic for images handled by onerror in the HTML string
          return `<div class="role-chip">
            <span>${app.escapeHtml(role)}</span>
          </div>`;
        }).join('');
      } else {
        rolesHTML = `<span style="font-size:12px; color:#555;">No designated roles</span>`;
      }

      const html = `
        <div class="profile-card">
          <div class="profile-banner">
            ${bannerHTML}
          </div>
          
          <div class="profile-content">
            <div class="avatar-row">
              <div class="avatar-wrapper">
                <img class="profile-avatar" src="${app.escapeHtml(avatar)}" alt="${app.escapeHtml(user.username)}">
              </div>
              
              <!-- Action Buttons Container -->
              <div class="action-buttons" id="actionButtons" style="display:flex; gap:10px;">
                <button class="action-btn" onclick="app.copyLink()">
                  <i class="ph-bold ph-share-network"></i> Share
                </button>
              </div>
            </div>

            <div class="user-identity">
              <div class="username-wrap">
                <h1 class="username scramble-hover" data-text="${app.escapeHtml(user.username)}">${app.escapeHtml(user.username)}</h1>
                ${verifiedBadge}
              </div>
              <div style="color:var(--c-accent); font-size:12px; font-weight:700; letter-spacing:1px; text-transform:uppercase;">
                ${user.role ? app.escapeHtml(user.role) : 'MEMBER'}
              </div>
            </div>

            <div class="bio-text">
              ${safeBio ? safeBio : '<span style="opacity:0.4">Nothing to show</span>'}
            </div>

            <div style="border-top:1px solid rgba(255,255,255,0.05); padding-top:15px;">
              <div style="font-size:10px; color:var(--c-text-dim); letter-spacing:1px; margin-bottom:8px;">ROLES</div>
              <div class="roles-grid">
                ${rolesHTML}
              </div>
            </div>

          </div>
        </div>
      `;

      document.getElementById('profile-target').innerHTML = html;
    },

    checkAuth: async (profile) => {
      const { data: { session } } = await supabaseClient.auth.getSession();
      
      if (session && session.user && session.user.id === profile.id) {
        const container = document.getElementById("actionButtons");
        if(container) {
          const editBtn = document.createElement("a");
          editBtn.href = `/@${encodeURIComponent(profile.username)}/edit`;
          editBtn.className = "action-btn primary";
          editBtn.innerHTML = `<i class="ph-bold ph-pencil-simple"></i> Edit`;
          container.prepend(editBtn);
        }
      }
    },

    copyLink: () => {
      navigator.clipboard.writeText(window.location.href).then(() => {
        const btn = document.querySelector('.ph-share-network').parentElement;
        const originalHtml = btn.innerHTML;
        btn.innerHTML = `<i class="ph-bold ph-check"></i> Copied`;
        setTimeout(() => { btn.innerHTML = originalHtml; }, 2000);
      });
    },

    renderError: (msg) => {
      document.getElementById('profile-target').innerHTML = `
        <div class="profile-card error-msg">
          <i class="ph ph-warning-octagon" style="font-size: 48px; margin-bottom: 10px; color:var(--c-accent)"></i>
          <h3 style="color:#fff">ACCESS DENIED</h3>
          <p style="color:var(--c-text-dim)">${msg}</p>
          <a href="/" class="action-btn" style="display:inline-flex; margin-top:20px;">Return Home</a>
        </div>
      `;
    }
  };

  window.addEventListener('DOMContentLoaded', app.init);

</script>
</body>
</html>
